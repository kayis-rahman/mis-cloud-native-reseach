spring:
  application:
    name: api-gateway-test
  cloud:
    gateway:
      # Enable gateway for integration tests
      enabled: true
      routes:
        # Test routes with mock backends
        - id: test-cart
          uri: http://httpbin.org
          predicates:
            - Path=/api/cart/**
          filters:
            - StripPrefix=2
        - id: test-products
          uri: http://httpbin.org
          predicates:
            - Path=/api/products/**
          filters:
            - StripPrefix=2
        - id: test-identity
          uri: http://httpbin.org
          predicates:
            - Path=/api/identity/**
          filters:
            - StripPrefix=2
        - id: test-orders
          uri: http://httpbin.org
          predicates:
            - Path=/api/orders/**
          filters:
            - StripPrefix=2
        - id: test-payments
          uri: http://httpbin.org
          predicates:
            - Path=/api/payments/**
          filters:
            - StripPrefix=2
    discovery:
      enabled: false
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://test-issuer
  main:
    web-application-type: reactive

# Observability configuration for tests
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
    metrics:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}
      service: api-gateway
      environment: test
    web:
      server:
        request:
          autotime:
            enabled: true

# Simplified logging configuration for tests - console only
logging:
  level:
    com.sparkage: INFO
    org.springframework.cloud.gateway: INFO
    org.springframework.test: WARN
    org.springframework.web: WARN
    net.logstash.logback: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
  # Disable file logging for tests
  file:
    name: ""

# Override security settings for tests
security:
  api-keys: test-key
  header-name: X-API-Key

# Disable external dependencies for tests
opentracing:
  jaeger:
    enabled: false
