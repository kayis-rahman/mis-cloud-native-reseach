# Kubernetes and Observability Profile Configuration
# This profile is activated when SPRING_PROFILES_ACTIVE includes "kubernetes,observability"

spring:
  application:
    name: ${SPRING_APPLICATION_NAME:api-gateway}

  # Cloud Gateway Configuration
  cloud:
    gateway:
      metrics:
        enabled: true
      discovery:
        locator:
          enabled: false

# Management and Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: ${MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE:health,info,metrics,prometheus}
  endpoint:
    metrics:
      enabled: ${MANAGEMENT_ENDPOINT_METRICS_ENABLED:true}
    prometheus:
      enabled: ${MANAGEMENT_ENDPOINT_PROMETHEUS_ENABLED:true}
    health:
      enabled: true
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: ${MANAGEMENT_METRICS_EXPORT_PROMETHEUS_ENABLED:true}
    distribution:
      percentiles-histogram:
        http.server.requests: true
      percentiles:
        http.server.requests: 0.5, 0.95, 0.99
      sla:
        http.server.requests: 10ms, 50ms, 100ms, 200ms, 500ms

# OpenTracing Jaeger Configuration
opentracing:
  jaeger:
    service-name: ${OPENTRACING_JAEGER_SERVICE_NAME:api-gateway}
    sampler-type: ${OPENTRACING_JAEGER_SAMPLER_TYPE:const}
    sampler-param: ${OPENTRACING_JAEGER_SAMPLER_PARAM:1}
    log-spans: false
    enable-b3-propagation: true
    udp-sender:
      host: ${JAEGER_AGENT_HOST:jaeger-agent-service.observability.svc.cluster.local}
      port: ${JAEGER_AGENT_PORT:6831}

# Logging Configuration
logging:
  level:
    com.sparkage: ${LOGGING_LEVEL_COM_SPARKAGE:DEBUG}
    org.springframework.cloud.gateway: ${LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_CLOUD_GATEWAY:DEBUG}
    org.springframework.web: INFO
    org.springframework.security: INFO
  pattern:
    console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}"

---
# Development Profile (when not in Kubernetes)
spring:
  config:
    activate:
      on-profile: "!kubernetes"
  application:
    name: api-gateway

# Local development logging
logging:
  level:
    com.sparkage: DEBUG
    org.springframework.cloud.gateway: DEBUG
